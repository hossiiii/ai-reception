# AIå—ä»˜ã‚·ã‚¹ãƒ†ãƒ  LLMãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

LLMãƒ™ãƒ¼ã‚¹ã®AIå—ä»˜ã‚·ã‚¹ãƒ†ãƒ ã®å“è³ªã‚’å®šé‡çš„ãƒ»å®šæ€§çš„ã«è©•ä¾¡ã—ã€å…·ä½“çš„ãªæ”¹å–„ææ¡ˆã‚’ç”Ÿæˆã™ã‚‹ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚

## ğŸ¯ ãƒ†ã‚¹ãƒˆã®ç›®çš„

- **æƒ³å®šæŒ™å‹•ã®ç¢ºèª**: è¨­è¨ˆé€šã‚Šã®å‹•ä½œã‚’ã—ã¦ã„ã‚‹ã‹ã‚’åˆ¤å®š
- **æ”¹å–„ç‚¹ã®ç‰¹å®š**: ä½•ãŒå•é¡Œã§ã€ã©ã“ã‚’ä¿®æ­£ã™ã¹ãã‹ã‚’æ˜ç¢ºåŒ–
- **å“è³ªã®ç¶™ç¶šç›£è¦–**: ä¿®æ­£å‰å¾Œã®æ¯”è¼ƒã«ã‚ˆã‚‹æ”¹å–„ç¢ºèª

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
backend/tests/
â”œâ”€â”€ llm_test_framework.py      # ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯æœ¬ä½“
â”œâ”€â”€ llm_test_runner.py         # APIé€£æºã¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
â”œâ”€â”€ test_llm_integration.py    # pytestå®Ÿè¡Œå¯èƒ½ãªãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ test_scenarios.yaml        # ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªå®šç¾©
â””â”€â”€ README_LLM_TESTING.md      # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã®å®Ÿè¡Œ
pytest test_llm_integration.py -v

# ç‰¹å®šã‚«ãƒ†ã‚´ãƒªã®ãƒ†ã‚¹ãƒˆ
pytest test_llm_integration.py::TestLLMIntegration::test_appointment_scenarios -v

# è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆä»˜ãã§å®Ÿè¡Œ
pytest test_llm_integration.py --llm-report
```

### 2. å€‹åˆ¥ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ

```python
from llm_test_runner import LLMTestRunner

# ç‰¹å®šã‚·ãƒŠãƒªã‚ªã®ã¿ãƒ†ã‚¹ãƒˆ
runner = LLMTestRunner()
await runner.run_and_report(["APT-001", "SALES-001"])
```

### 3. ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

`test_scenarios.yaml`ã‚’ç·¨é›†ã—ã¦ç‹¬è‡ªã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ :

```yaml
test_scenarios:
  custom_cases:
    - id: "CUSTOM-001"
      name: "ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹"
      conversation:
        - step: 1
          user_input: "ãƒ†ã‚¹ãƒˆç”¨ã®å…¥åŠ›"
          expected:
            visitor_type: "appointment"
            extracted_info:
              name: "æœŸå¾…ã•ã‚Œã‚‹åå‰"
```

## ğŸ“Š åˆ¤å®šåŸºæº–ã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹

### æˆåŠŸ/å¤±æ•—ã®åˆ¤å®š

å„ãƒ†ã‚¹ãƒˆã¯ä»¥ä¸‹ã®åŸºæº–ã§è©•ä¾¡ã•ã‚Œã¾ã™ï¼š

| é …ç›® | åŸºæº– | é‡è¦åº¦ |
|------|------|--------|
| æƒ…å ±æŠ½å‡ºç²¾åº¦ | 80%ä»¥ä¸Š | é«˜ |
| å¿œç­”å“è³ª | 80%ä»¥ä¸Š | é«˜ |
| ä¼šè©±ãƒ•ãƒ­ãƒ¼ | 90%ä»¥ä¸Š | ä¸­ |
| ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å«æœ‰ | 100% | ä¸­ |

### å“è³ªã‚¹ã‚³ã‚¢

- **ä¸å¯§ã•**: æ•¬èªè¡¨ç¾ã®ä½¿ç”¨ç‡
- **æ˜ç¢ºã•**: å¿œç­”ã®é•·ã•ã¨ç†è§£ã—ã‚„ã™ã•
- **é©åˆ‡æ€§**: ä¸é©åˆ‡ãªè¡¨ç¾ã®å›é¿

## ğŸ“ˆ ãƒ†ã‚¹ãƒˆçµæœã®è¦‹æ–¹

### 1. å€‹åˆ¥ãƒ†ã‚¹ãƒˆçµæœ

```
âœ… APT-001: æ¨™æº–çš„ãªäºˆç´„æ¥å®¢
   ä¿¡é ¼åº¦: 0.95
   è©³ç´°åˆ¤å®š:
   - name_extraction: âœ… æ­£ç¢º (ç”°ä¸­å¤ªéƒ)
   - company_extraction: âœ… æ­£ç¢º (ABCå•†äº‹)
   - visitor_type_classification: âœ… æ­£ç¢º (appointment)
```

### 2. å…¨ä½“ã‚µãƒãƒªãƒ¼

```
ğŸ“Š ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼
- å…¨ä½“æˆåŠŸç‡: 87% (26/30)
- å¹³å‡ä¿¡é ¼åº¦: 0.84
- æƒ…å ±æŠ½å‡ºç²¾åº¦: 91%
- å¿œç­”å“è³ª: 88%
```

### 3. æ”¹å–„ææ¡ˆ

```
ğŸ¯ å…·ä½“çš„æ”¹å–„ææ¡ˆ
1. å–¶æ¥­ãƒ»äºˆç´„ã®åˆ†é¡ç²¾åº¦å‘ä¸Š
   ä¿®æ­£å¯¾è±¡: app/agents/nodes.py
   ææ¡ˆå†…å®¹: ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å…·ä½“ä¾‹ã‚’è¿½åŠ 
```

## ğŸ”§ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### 1. æ–°ã—ã„ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã®è¿½åŠ 

```python
class CustomValidator(BaseValidator):
    def validate(self, response, expected) -> TestResult:
        # ã‚«ã‚¹ã‚¿ãƒ æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯
        pass

# ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«è¿½åŠ 
validator = DetailedValidator()
validator.custom_validators["my_check"] = CustomValidator()
```

### 2. æ”¹å–„ææ¡ˆãƒ«ãƒ¼ãƒ«ã®è¿½åŠ 

`test_scenarios.yaml`ã®`improvement_rules`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç·¨é›†:

```yaml
improvement_rules:
  custom_issues:
    - pattern: "æ–°ã—ã„å•é¡Œãƒ‘ã‚¿ãƒ¼ãƒ³"
      category: "prompt"
      suggested_fix: "å…·ä½“çš„ãªä¿®æ­£ææ¡ˆ"
      file: "ä¿®æ­£å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«"
```

## ğŸ“‹ ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã®è¿½åŠ 

### 1. åŸºæœ¬æ§‹é€ 

```yaml
- id: "NEW-001"
  name: "æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹"
  priority: "high"  # high, medium, low
  conversation:
    - step: 1
      user_input: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›"
      expected:
        visitor_type: "æœŸå¾…ã™ã‚‹è¨ªå•è€…ã‚¿ã‚¤ãƒ—"
        extracted_info:
          name: "æœŸå¾…ã™ã‚‹åå‰"
          company: "æœŸå¾…ã™ã‚‹ä¼šç¤¾å"
        must_include_keywords: ["å¿…é ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"]
        quality_checks:
          check_politeness: true
          max_length: 150
```

### 2. è¤‡æ•°ã‚¹ãƒ†ãƒƒãƒ—ã®ä¼šè©±

```yaml
conversation:
  - step: 1
    user_input: "æœ€åˆã®å…¥åŠ›"
    expected: {...}
  
  - step: 2
    user_input: "2ç•ªç›®ã®å…¥åŠ›"
    system_event: "calendar_not_found"  # ã‚·ã‚¹ãƒ†ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ
    expected: {...}
```

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 1. APIæ¥ç¶šã‚¨ãƒ©ãƒ¼

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
curl http://localhost:8000/api/health

# ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª
echo $OPENAI_API_KEY
```

### 2. ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ã®èª¿æŸ»

```python
# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
runner = LLMTestRunner()
result = await runner.run_single_scenario("APT-001", api_client)

# è©³ç´°ãªçµæœã‚’ç¢ºèª
print(f"Issues: {result.issues}")
print(f"Suggestions: {result.suggestions}")
```

### 3. YAMLæ§‹æ–‡ã‚¨ãƒ©ãƒ¼

```bash
# YAMLæ§‹æ–‡ãƒã‚§ãƒƒã‚¯
python -c "import yaml; yaml.safe_load(open('test_scenarios.yaml'))"
```

## ğŸ“š ç¶™ç¶šçš„æ”¹å–„ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

1. **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**: å®šæœŸçš„ã«å…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã‚’å®Ÿè¡Œ
2. **çµæœåˆ†æ**: å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨æ”¹å–„ææ¡ˆã‚’ç¢ºèª
3. **ä¿®æ­£å®Ÿè£…**: ææ¡ˆã«åŸºã¥ã„ã¦ã‚³ãƒ¼ãƒ‰ã‚„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä¿®æ­£
4. **åŠ¹æœç¢ºèª**: ä¿®æ­£å¾Œã«åŒã˜ãƒ†ã‚¹ãƒˆã‚’å†å®Ÿè¡Œ
5. **æ–°è¦ãƒ†ã‚¹ãƒˆ**: æ–°æ©Ÿèƒ½ã‚„å•é¡Œã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ 

## ğŸ¯ æˆåŠŸåŸºæº–

ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³é‹ç”¨ã®ç›®å®‰ï¼š

- **å…¨ä½“æˆåŠŸç‡**: 90%ä»¥ä¸Š
- **æƒ…å ±æŠ½å‡ºç²¾åº¦**: 95%ä»¥ä¸Š  
- **å¿œç­”å“è³ª**: 85%ä»¥ä¸Š
- **ã‚¨ãƒ©ãƒ¼å›å¾©ç‡**: 80%ä»¥ä¸Š

## ğŸ”„ CI/CDã¨ã®çµ±åˆ

```yaml
# GitHub Actionsä¾‹
name: LLM Quality Check
on: [push, pull_request]
jobs:
  llm-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Run LLM tests
        run: |
          pip install -r requirements.txt
          pytest backend/tests/test_llm_integration.py --llm-report
```

ã“ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã‚ˆã‚Šã€LLMãƒ™ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ ã®å“è³ªã‚’ç¶™ç¶šçš„ã«ç›£è¦–ã—ã€ãƒ‡ãƒ¼ã‚¿é§†å‹•å‹ã®æ”¹å–„ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚